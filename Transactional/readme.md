# REQUIRES_NEW导致数据库连接死锁



在一个事务中，有两个子事务，A和B。

```
{
	 // A事务
	 // B事务
}
```

A事务的传播行为是`Propagation.REQUIRED`

B事务的传播行为是`Propagation.REQUIRES_NEW`



### 案例一

设置最大连接数为1，暂不设置获取连接等待时长

由于最大连接数为1，那么开启B事务无法开启，由于未设置最大等待时长，主事务会一直等待B事务执行



### 案例二

设置最大连接数为1， 同时设置获取连接等待时长

由于最大连接数为1，那么开启B事务无法开启，超时会抛出异常，由于A事在主事务中，主事务设置异常回滚，那么A事务也会回滚。



### 案例三

设置最大连接数为2， 同时设置获取连接等待时长

A事务传播行为设置为`Propagation.REQUIRES_NEW`

那么A事务开启成功，B事务同样会开启失败

那么超时发生异常后，由于A事务是新起事务，不会回滚



### 参考链接

 https://cloud.tencent.com/developer/article/1466196 
 https://www.jianshu.com/p/8047f03a3b61